---
title: "R Notebook"
#output: html_notebook
---

# Environment

```{r}
library(dplyr)
```


# Load data

```{r}
estudio_vacunas_t_final_selected <- readRDS("/opt/datos_compartidos/vacunas_data/Rfiles/estudio_vacunas_t_final_selected.rds")
```

# Aggregate data by town

```{r}
municipio_aggregated <- estudio_vacunas_t_final_selected  %>%
  group_by(desc_municipio,cod_municipio) %>%
  summarize(
            infect_COVID_first_date_min = min(infect_covid_first_date),
            infect_COVID_first_date_max = max(infect_covid_first_date),
            infect_COVID_first_date_median = median(infect_covid_first_date),
            infect_COVID_first_date_sd = sd(infect_covid_first_date),
            DESC_SEXO_Mujer = sum(desc_sexo == "Mujer"),
            DESC_SEXO_Hombre = sum(desc_sexo == "Hombre"),
            FEC_FALLECIMIENTO_count = n_distinct(fec_fallecimiento),
            age_median = median(age),
            age_sd = sd(age),
            asma_count = sum(asma,na.rm = T),
            cancer_colorrectal_count = sum(cancer_colorrectal,na_rm = T),
            cancer_de_bronquio_y_pulmon_count = sum(cancer_de_bronquio_y_pulmon,na_rm = T),
            cancer_de_cabeza_y_cuello_count = sum(cancer_de_cabeza_y_cuello,na_rm = T),
            cancer_de_cuello_uterino_count = sum(cancer_de_cuello_uterino,na_rm = T),
            cancer_de_estomago_count = sum(cancer_de_estomago,na_rm = T),
            cancer_de_higado_y_vias_biliares_count = sum(cancer_de_higado_y_vias_biliares,na_rm = T),
            cancer_de_hueso_y_tejidos_blandos_count = sum(cancer_de_hueso_y_tejidos_blandos,na_rm = T),
            cancer_de_mama_count = sum(cancer_de_mama,na_rm = T),
            cancer_de_ovario_count = sum(cancer_de_ovario,na_rm = T),
            cancer_de_pancreas_count = sum(cancer_de_pancreas,na_rm = T),
            cancer_de_prostata_count = sum(cancer_de_prostata,na_rm = T),
            cancer_de_rinon_y_pelvis_renal_count = sum(cancer_de_rinon_y_pelvis_renal,na_rm = T),
            cancer_de_testiculo_count = sum(cancer_de_testiculo,na_rm = T),
            cancer_de_tiroides_count = sum(cancer_de_tiroides,na_rm = T),
            cancer_de_utero_count = sum(cancer_de_utero,na_rm = T),
            cancer_de_vejiga_count = sum(cancer_de_vejiga,na_rm = T),
            cancer_inmunoproliferativo_count = sum(cancer_inmunoproliferativo,na_rm = T),
            cardiopatia_isquemica_count = sum(cardiopatia_isquemica,na_rm = T),
            cirrosis_hepatica_count = sum(cirrosis_hepatica,na_rm = T),
            diabetes_count = sum(diabetes,na_rm = T),
            enfermedad_de_hodgkin_count = sum(enfermedad_de_hodgkin,na_rm = T),
            epoc_count = sum(epoc,na_rm = T),
            hepatopatia_cronica_excepto_cirrosis_count = sum(hepatopatia_cronica_excepto_cirrosis,na_rm = T),
            hipertension_count = sum(hipertension,na_rm = T),
            insuficiencia_cardiaca_count = sum(insuficiencia_cardiaca,na_rm = T),
            insuficiencia_renal_cronica_count = sum(insuficiencia_renal_cronica,na_rm = T),
            leucemia_count = sum(leucemia,na_rm = T),
            linfoma_no_hodgkin_count = sum(linfoma_no_hodgkin,na_rm = T),
            melanoma_de_piel_count = sum(melanoma_de_piel,na_rm = T),
            sarcoma_de_kaposi_count = sum(sarcoma_de_kaposi,na_rm = T),
            vih_count = sum(vih,na.rm = T),
            infecc_covid_num_median = median(infecc_covid_num,na.rm = T),
            estancia_hospitalaria_dias_median = median(estancia_hospitalaria_dias,na.rm = T),
            hosp_stay_bin_count = sum(hosp_stay_bin,na.rm = T),
            icu_stay_bin_count = sum(as.numeric(icu_stay_bin),na.rm = T),
            infeccion_ingreso_dias_median = median(infeccion_ingreso_dias,na.rm = T),
            cancer_organo_solido_count = sum(cancer_organo_solido),
            cancer_hematologico_count = sum(cancer_hematologico),
            pautas_covid_median = sum(as.numeric(pautas_covid),na.rm = T ),
            pautas_covid_sd = sd(as.numeric(pautas_covid),na.rm = T ),
            pautas_covid_1pauta_count = sum(pautas_covid == "1"),
            pautas_covid_2pauta_count = sum(pautas_covid == "2"),
            pautas_covid_3pauta_count = sum(pautas_covid == "3")
                        )    
```
# Export file

```{r}
write.csv(municipio_aggregated,'municipio_aggregated.csv',row.names = F)
```



